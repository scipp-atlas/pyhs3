[workspace]
preview = ["pixi-build"]
channels = ["conda-forge"]
platforms = ["linux-64", "linux-aarch64", "osx-64", "osx-arm64", "win-64"]

[dependencies]
python = "*"
pyhs3 = { path = "./" }

[package]
name = "pyhs3"
version = "latest"

[package.build]
backend = { name = "pixi-build-python", version = "==0.4.0" }

[package.host-dependencies]
hatchling = ">=1.25"
hatch-vcs = ">=0.4"

[package.run-dependencies]
rich = "*"
rustworkx = "*"
pytensor = ">=2.33.0"
numpy = "*"
sympy = "*"
pydantic = "*"

[feature.test]
platforms = ["linux-64", "linux-aarch64", "osx-64", "osx-arm64"]

[feature.docs]
platforms = ["linux-64", "linux-aarch64", "osx-64", "osx-arm64"]

[feature.py310.dependencies]
python = "<3.11,>=3.10"

[feature.py311.dependencies]
python = "<3.12,>=3.11"

[feature.py312.dependencies]
python = "<3.13,>=3.12"

[feature.py313.dependencies]
python = "<3.14,>=3.13"

[feature.test.dependencies]
pytest = ">=9"
pytest-cov = ">=3"
pyhf = ">=0.7.6"
pydocstyle = "*"
scikit-hep-testdata = ">=0.5.7"
pydot = "*"
graphviz = "*"

[feature.test.target.linux-64.dependencies]
root_base = ">=6.32.10,<7"

[feature.test.target.linux-aarch64.dependencies]
root_base = ">=6.32.10,<7"

[feature.test.target.osx-64.dependencies]
root_base = ">=6.32.10,<7"

[feature.test.target.osx-arm64.dependencies]
root_base = ">=6.32.10,<7"

[feature.test.tasks]
_test = "pytest"
_test-cov = "pytest --cov=pyhs3 --cov-report=term --cov-report=html"
_test-slow = "pytest --runslow"
_test-pydot = "pytest --runpydot"
_test-all = "pytest --runslow --runpydot --cov=pyhs3"
_doctest = "pytest --doctest-modules src/pyhs3"

[feature.docs.dependencies]
sphinx = ">=7.0"
myst-parser = ">=0.13"
sphinx-copybutton = ">=0.3.2,!=0.5.1"
sphinx-autodoc-typehints = "*"
furo = ">=2023.08.17"
sphinx-click = "*"
ipywidgets = "*"
intersphinx-registry = ">=0.2411.17"
sphinx-issues = "*"
sphinxcontrib-mermaid = "*"
sphinxcontrib-bibtex = "*"
sphinx-autobuild = "*"

[feature.docs.tasks]
_docs-build = "sphinx-build -n -T -b html docs docs/_build/html"
_docs-serve = "sphinx-autobuild --open-browser -n -T -b html docs docs/_build/html"
_docs-clean = "rm -rf docs/_build"
_docs-api = "sphinx-apidoc -o docs/api/ --module-first --no-toc --force src/pyhs3"

[feature.dev.dependencies]
pre-commit = "*"
pylint = ">=3.2"
tbump = ">=6.7.0"
mypy = "*"
ruff = "*"
python-build = "*"

[feature.dev.pypi-dependencies]
pylint-pydantic = "*"

[feature.dev.tasks]
_pre-commit = "pre-commit run --all-files"
_pylint = "pylint pyhs3"
_pre-commit-install = "pre-commit install"
_pre-commit-update = "pre-commit autoupdate"
_build-clean = "rm -rf build dist"
_build = { cmd = "python -m build", depends-on = ["_build-clean"] }

[environments]
test = ["test"]
docs = ["docs"]
dev = ["test", "docs", "dev"]
py310 = ["test", "py310"]
py311 = ["test", "py311"]
py312 = ["test", "py312"]
py313 = ["test", "py313"]

[tasks]
# Testing tasks
test = { depends-on = [{ task = "_test", environment = "test" }], description = "Run basic pytest tests" }
test-cov = { depends-on = [{ task = "_test-cov", environment = "test" }], description = "Run tests with coverage reporting" }
test-slow = { depends-on = [{ task = "_test-slow", environment = "test" }], description = "Run tests including slow tests" }
test-pydot = { depends-on = [{ task = "_test-pydot", environment = "test" }], description = "Run tests including pydot tests" }
test-all = { depends-on = [{ task = "_test-all", environment = "test" }], description = "Run all tests with coverage (slow + pydot)" }
doctest = { depends-on = [{ task = "_doctest", environment = "test" }], description = "Run doctests in source modules" }

# Documentation tasks
docs-build = { depends-on = [{ task = "_docs-build", environment = "docs" }], description = "Build documentation (static)" }
docs-serve = { depends-on = [{ task = "_docs-serve", environment = "docs" }], description = "Build and serve documentation with live reload" }
docs-clean = { depends-on = [{ task = "_docs-clean", environment = "docs" }], description = "Clean documentation build artifacts" }
docs-api = { depends-on = [{ task = "_docs-api", environment = "docs" }], description = "Regenerate API documentation" }

# Linting and code quality tasks
pre-commit = { depends-on = [{ task = "_pre-commit", environment = "dev" }], description = "Run pre-commit hooks on all files" }
pylint = { depends-on = [{ task = "_pylint", environment = "dev" }], description = "Run PyLint on pyhs3 package" }
lint = { depends-on = ["pre-commit", "pylint"], description = "Run all linting (pre-commit + pylint)" }

# Development utility tasks
pre-commit-install = { depends-on = [{ task = "_pre-commit-install", environment = "dev" }], description = "Install pre-commit git hooks" }
pre-commit-update = { depends-on = [{ task = "_pre-commit-update", environment = "dev" }], description = "Update pre-commit hook versions" }
build-clean = { depends-on = [{ task = "_build-clean", environment = "dev" }], description = "Clean build artifacts" }
build = { depends-on = [{ task = "_build", environment = "dev" }], description = "Build SDist and wheel distributions" }

# Composite tasks for common workflows
check = { depends-on = ["lint", "test"], description = "Quick check: lint + basic tests" }
check-all = { depends-on = ["lint", "test-all"], description = "Comprehensive check: lint + all tests" }
